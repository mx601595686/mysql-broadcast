"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const service_starter_1 = require("service-starter");
class ClearTrigger extends service_starter_1.ServiceModule {
    get _mysqlCon() {
        return this.services.MysqlConnection;
    }
    constructor() {
        super();
        this.onStop = this.onStart;
    }
    async onStart() {
        const queryTrigger = "\
            SELECT \
                `TRIGGER_NAME` as `name`, `TRIGGER_SCHEMA` as `schema` \
            FROM \
                `INFORMATION_SCHEMA`.`TRIGGERS` \
            WHERE \
                `TRIGGER_NAME` LIKE '__mb__%' \
        ";
        const triggers = await this._mysqlCon.query(queryTrigger);
        for (let item of triggers) {
            const sql = 'DROP TRIGGER IF EXISTS `' + item.schema + '`.`' + item.name + '`';
            await this._mysqlCon.query(sql);
        }
    }
}
exports.default = ClearTrigger;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRiQ2hhbmdlTGlzdGVuZXIvQ2xlYXJUcmlnZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEscURBQXFEO0FBWXJELGtCQUFrQyxTQUFRLCtCQUFhO0lBRW5ELElBQVksU0FBUztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFrQyxDQUFDO0lBQzVELENBQUM7SUFFRDtRQUNJLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQy9CLENBQUM7SUFFRCxLQUFLLENBQUMsT0FBTztRQUdULE1BQU0sWUFBWSxHQUFHOzs7Ozs7O1NBT3BCLENBQUM7UUFDRixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRzFELEdBQUcsQ0FBQSxDQUFDLElBQUksSUFBSSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdkIsTUFBTSxHQUFHLEdBQUcsMEJBQTBCLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7WUFDL0UsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwQyxDQUFDO0lBQ0wsQ0FBQztDQUNKO0FBOUJELCtCQThCQyIsImZpbGUiOiJEYkNoYW5nZUxpc3RlbmVyL0NsZWFyVHJpZ2dlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNlcnZpY2VNb2R1bGUsIGxvZyB9IGZyb20gXCJzZXJ2aWNlLXN0YXJ0ZXJcIjtcblxuaW1wb3J0IE15c3FsQ29ubmVjdGlvbiBmcm9tICcuLi9NeVNRTC9NeXNxbENvbm5lY3Rpb24nO1xuXG4vKipcbiAqIOa4heeQhueoi+W6j+WcqOaVsOaNruW6k+S4reazqOWGjOeahOinpuWPkeWZqOOAgiAgIFxuICog5omA5pyJ56iL5bqP5rOo5YaM55qE6Kem5Y+R5Zmo6YO95piv5Lul4oCcX21iX+KAneW8gOWktFxuICogXG4gKiBAZXhwb3J0XG4gKiBAY2xhc3MgQ2xlYXJUcmlnZ2VyXG4gKiBAZXh0ZW5kcyB7U2VydmljZU1vZHVsZX1cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2xlYXJUcmlnZ2VyIGV4dGVuZHMgU2VydmljZU1vZHVsZSB7XG5cbiAgICBwcml2YXRlIGdldCBfbXlzcWxDb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2VzLk15c3FsQ29ubmVjdGlvbiBhcyBNeXNxbENvbm5lY3Rpb247XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMub25TdG9wID0gdGhpcy5vblN0YXJ0O1xuICAgIH1cblxuICAgIGFzeW5jIG9uU3RhcnQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIFxuICAgICAgICAvLyDmn6Xor6Lns7vnu5/lt7Lms6jlhoznmoRUcmlnZ2VyXG4gICAgICAgIGNvbnN0IHF1ZXJ5VHJpZ2dlciA9IFwiXFxcbiAgICAgICAgICAgIFNFTEVDVCBcXFxuICAgICAgICAgICAgICAgIGBUUklHR0VSX05BTUVgIGFzIGBuYW1lYCwgYFRSSUdHRVJfU0NIRU1BYCBhcyBgc2NoZW1hYCBcXFxuICAgICAgICAgICAgRlJPTSBcXFxuICAgICAgICAgICAgICAgIGBJTkZPUk1BVElPTl9TQ0hFTUFgLmBUUklHR0VSU2AgXFxcbiAgICAgICAgICAgIFdIRVJFIFxcXG4gICAgICAgICAgICAgICAgYFRSSUdHRVJfTkFNRWAgTElLRSAnX19tYl9fJScgXFxcbiAgICAgICAgXCI7XG4gICAgICAgIGNvbnN0IHRyaWdnZXJzID0gYXdhaXQgdGhpcy5fbXlzcWxDb24ucXVlcnkocXVlcnlUcmlnZ2VyKTtcblxuICAgICAgICAvLyDliKDpmaTns7vnu5/ms6jlhozkuobnmoTop6blj5HlmahcbiAgICAgICAgZm9yKGxldCBpdGVtIG9mIHRyaWdnZXJzKSB7XG4gICAgICAgICAgICBjb25zdCBzcWwgPSAnRFJPUCBUUklHR0VSIElGIEVYSVNUUyBgJyArIGl0ZW0uc2NoZW1hICsgJ2AuYCcgKyBpdGVtLm5hbWUgKyAnYCc7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9teXNxbENvbi5xdWVyeShzcWwpO1xuICAgICAgICB9XG4gICAgfVxufSJdfQ==
